#!/usr/bin/env bash

cd "$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/.." || exit 1

if [ "$1" == 'plugins' ]; then
    plugin_dir="$( cd examples/plugins && pwd )"
    ln -s "$plugin_dir" "$HOME/.clowder"
    exit
fi

script/clean 'test' || exit 1

pushd clowder_test || exit 1

case "$(uname)" in
    Linux*) export PLATFORM="linux";
        pip install -e . || exit 1
        ;;
    Darwin*) export PLATFORM="darwin";
        sudo -H pip install -e . || exit 1
        ;;
    CYGWIN*) export PLATFORM="windows";
        pip install -e . || exit 1
        ;;
esac

echo "Installed clowder-test for $PLATFORM"
popd || exit 1
