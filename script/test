#!/usr/bin/env bash

cd "$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/.." || exit 1

if [ "$1" == 'plugins' ]; then
    plugin_dir="$( cd examples/plugins && pwd )"
    ln -s "$plugin_dir" "$HOME/.clowder"
    exit
fi

script/clean 'test' || exit 1

cd clowder_test || exit 1

case "$(uname)" in
    Linux*) export MY_PLATFORM="linux";
        pip3 install -e . || exit 1
        ;;
    Darwin*) export MY_PLATFORM="osx";
        sudo -H pip3 install -e . || exit 1
        ;;
    CYGWIN*) export MY_PLATFORM="windows";
        pip3 install -e . || exit 1
        ;;
esac
